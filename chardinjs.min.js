// Generated by CoffeeScript 1.6.3
(function(){var e=[].slice;(function(t,n){var r;return r=function(){function e(e){var r=this;this.$el=t(e),this.sequenced=this.$el.data("sequenced")?!0:!1,this.sequencedItems=this._getSequencedElements(),this.sequenceIdx=0,this.timeOut=null,this.isAuto=this.$el.data("auto")?!0:!1,this.delayTime=this.$el.data("delay")||2e3,t(n).resize(function(){return r.refresh()})}return e.prototype.start=function(){var e,t,n,r;if(this._overlay_visible())return!1;this._add_overlay_layer();if(!this.sequenced){r=this.$el.find("*[data-intro]");for(t=0,n=r.length;t<n;t++)e=r[t],this._show_element(e)}else this._show_sequenced_element();return this.$el.trigger("chardinJs:start")},e.prototype.toggle=function(){return this._overlay_visible()?this.stop():this.start()},e.prototype.refresh=function(){var e,t,n,r,i;if(this._overlay_visible()){r=this.$el.find("*[data-intro]"),i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(this._position_helper_layer(e));return i}return this},e.prototype.stop=function(){return this.$el.find(".chardinjs-overlay").fadeOut(function(){return t(this).remove()}),this.$el.find(".chardinjs-helper-layer").remove(),this.$el.find(".chardinjs-show-element").removeClass("chardinjs-show-element"),this.$el.find(".chardinjs-relative-position").removeClass("chardinjs-relative-position"),n.removeEventListener?n.removeEventListener("keydown",this._onKeyDown,!0):document.detachEvent&&document.detachEvent("onkeydown",this._onKeyDown),this.sequenceIdx=0,this.$el.trigger("chardinJs:stop")},e.prototype.next=function(e){var t,n,r=this;return clearTimeout(this.timeOut),e=e!==!1?!0:!1,this.sequenceIdx++,n=this.sequenceIdx,t=this.sequencedItems[this.sequenceIdx],e?this.timeOut=setTimeout(function(){return r._remove_sequenced_element(0),r._show_sequenced_element(!0),r.$el.trigger("chardinJs:next",[n,t])},this.delayTime):(this._remove_sequenced_element(0),this._show_sequenced_element(!1),this.$el.trigger("chardinJs:next",[n,t]))},e.prototype.previous=function(e){var t,n,r=this;return clearTimeout(this.timeOut),e=e!==!1?!0:!1,this.sequenceIdx--,n=this.sequenceIdx,t=this.sequencedItems[this.sequenceIdx],e?this.timeOut=setTimeout(function(){return r._remove_sequenced_element(0),r._show_sequenced_element(!0),r.$el.trigger("chardinJs:previous",[n,t])},this.delayTime):(this._remove_sequenced_element(0),this._show_sequenced_element(!1),this.$el.trigger("chardinJs:previous",[n,t]))},e.prototype._overlay_visible=function(){return this.$el.find(".chardinjs-overlay").length!==0},e.prototype._add_overlay_layer=function(){var e,t,n,r=this;return this._overlay_visible()?!1:(t=document.createElement("div"),n="",t.className="chardinjs-overlay",this.$el.prop("tagName")==="BODY"?(n+="top: 0;bottom: 0; left: 0;right: 0;position: fixed;",t.setAttribute("style",n)):(e=this._get_offset(this.$el.get()[0]),e&&(n+="width: "+e.width+"px; height:"+e.height+"px; top:"+e.top+"px;left: "+e.left+"px;",t.setAttribute("style",n))),this.$el.get()[0].appendChild(t),t.onclick=function(e){return r.sequenced?r._handleMouseClick(e):r.stop()},setTimeout(function(){return n+="opacity: .8;opacity: .8;-ms-filter: 'progid:DXImageTransform.Microsoft.Alpha(Opacity=80)';filter: alpha(opacity=80);",t.setAttribute("style",n)},10))},e.prototype._get_position=function(e){return e.getAttribute("data-position")||"bottom"},e.prototype._place_tooltip=function(e){var n,r,i,s,o,u,a;u=t(e).data("tooltip_layer"),a=this._get_offset(u),u.style.top=null,u.style.right=null,u.style.bottom=null,u.style.left=null;switch(this._get_position(e)){case"top":case"bottom":i=this._get_offset(e),o=i.width,r=t(u).width(),u.style.left=""+(o/2-a.width/2)+"px";break;case"left":case"right":i=this._get_offset(e),s=i.height,n=t(u).height(),u.style.top=""+(s/2-a.height/2)+"px"}switch(this._get_position(e)){case"left":return u.style.left="-"+(a.width-34)+"px";case"right":return u.style.right="-"+(a.width-34)+"px";case"bottom":return u.style.bottom="-"+a.height+"px";case"top":return u.style.top="-"+a.height+"px"}},e.prototype._position_helper_layer=function(e){var n,r;return r=t(e).data("helper_layer"),n=this._get_offset(e),r.setAttribute("style","width: "+n.width+"px; height:"+n.height+"px; top:"+n.top+"px; left: "+n.left+"px;")},e.prototype._remove_sequenced_element=function(e){return t(".chardinjs-helper-layer").eq(e).empty().remove(),t(".chardinjs-show-element").removeClass("chardinjs-show-element")},e.prototype._show_element=function(e){var n,r,i;r=document.createElement("div"),i=document.createElement("div"),t(e).data("helper_layer",r).data("tooltip_layer",i),e.id&&r.setAttribute("data-id",e.id),r.className="chardinjs-helper-layer chardinjs-"+this._get_position(e),this._position_helper_layer(e),this.$el.get()[0].appendChild(r),i.className="chardinjs-tooltip chardinjs-"+this._get_position(e),i.innerHTML="<div class='chardinjs-tooltiptext'>"+e.getAttribute("data-intro")+"</div>",r.appendChild(i),this._place_tooltip(e),e.className+=" chardinjs-show-element",n="",e.currentStyle?n=e.currentStyle.position:document.defaultView&&document.defaultView.getComputedStyle&&(n=document.defaultView.getComputedStyle(e,null).getPropertyValue("position")),n=n.toLowerCase();if(n!=="absolute"&&n!=="relative")return e.className+=" chardinjs-relative-position"},e.prototype._show_sequenced_element=function(e){var t=this;e=e!==!1?!0:!1,this.sequenceIdx<0&&(this.sequenceIdx=0);if(!this.sequencedItems[this.sequenceIdx])return this.stop();this._show_element(this.sequencedItems[this.sequenceIdx]);if(this.sequenceIdx<this.sequencedItems.length-1){if(this.isAuto)return this.timeOut=setTimeout(function(){return t.next(t.isAuto)},this.delayTime)}else if(this.isAuto)return this.timeOut=setTimeout(function(){return t.stop()},this.delayTime)},e.prototype._handleMouseClick=function(e){var t;t=this._getMaxSize(),e=e||n.event,e.clientX>=t.width/2&&this.next(!1);if(e.clientX<=t.width/2)return this.previous(!1)},e.prototype._getMaxSize=function(){var e,t,n,r;return e=document.body,n=document.documentElement,t=Math.max(e.scrollHeight,e.offsetHeight,n.clientHeight,n.scrollHeight,n.offsetHeight),r=Math.max(e.scrollWidth,e.offsetWidth,n.clientWidth,n.scrollWidth,n.offsetWidth),{width:r,height:t}},e.prototype._getSequencedElements=function(){return this.$el.find("*[data-intro]").sort(function(e,n){var r,i;return r=t(e).data("sequence")||100,i=t(n).data("sequence")||100,r-i})},e.prototype._get_offset=function(e){var t,n,r;t={width:e.offsetWidth,height:e.offsetHeight},n=0,r=0;while(e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop))n+=e.offsetLeft,r+=e.offsetTop,e=e.offsetParent;return t.top=r,t.left=n,t},e}(),t.fn.extend({chardinJs:function(){var n,i,s,o;return o=arguments[0],i=2<=arguments.length?e.call(arguments,1):[],n=t(this[0]),s=n.data("chardinJs"),s||n.data("chardinJs",s=new r(this,o)),typeof o=="string"&&s[o].apply(s,i),s}})})(window.jQuery,window)}).call(this);